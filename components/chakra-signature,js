import { Node, mergeAttributes } from "@tiptap/core"
import React, { useRef, useState } from "react"
import {
  NodeViewWrapper,
  NodeViewContent,
  ReactNodeViewRenderer,
} from "@tiptap/react"

import SignaturePad from "react-signature-canvas"

const SignatureNode = (props) => {
  const signatureProp = {
    signature: props.node.attrs.signature,
  }

  return (
    <NodeViewWrapper className="chakra-signature">
      <SignaturePad
        ref={signatureProp}
        canvasProps={{
          className: "signatureCanvas",
        }}
      />
      <NodeViewContent className="signature-content" />
    </NodeViewWrapper>
  )
}
export default Node.create({
  name: "ChakraSignature",

  group: "block",

  content: "inline*",

  parseHTML() {
    return [
      {
        tag: "chakra-signature",
      },
    ]
  },

  renderHTML({ HTMLAttributes }) {
    return ["chakra-signature", mergeAttributes(HTMLAttributes)]
  },

  addNodeView() {
    return ReactNodeViewRenderer(SignatureNode)
  },
})
